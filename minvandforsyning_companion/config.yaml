name: "Minvandforsyning Companion"
version: "0.2.2"
slug: "minvandforsyning_companion"
description: "Scraper minvandforsyning.dk via Playwright og udstiller JSON til HA (inkl. stabil cache + adaptiv polling + UI)"
arch:
  - amd64
  - aarch64
  - armv7
startup: services
boot: auto
init: false

# UI in HA (Supervisor)
ingress: true
ingress_port: 8080
ingress_entry: /ui
panel_icon: mdi:water
panel_title: "Minvandforsyning"

# Optional direct access without ingress
ports:
  8080/tcp: 8080
webui: "http://[HOST]:[PORT:8080]/ui"

options:
  # Login
  email: ""
  password: ""

  # Polling (adaptive)
  idle_poll_seconds: 1800          # how often when fresh data is expected NOT to arrive yet
  probe_after_minutes: 45          # after new data, wait this long before probing more often
  probe_poll_seconds: 120          # polling interval during probe window
  probe_max_minutes: 20            # max time to stay in probe mode before going back to idle
  min_poll_seconds: 30             # hard minimum interval (safety)
  jitter_seconds: 15               # random jitter to avoid hammering

  # Stability
  keep_last_on_error: true         # keep last good value if scrape fails
  allow_decrease: false            # normally total should never go down
  decrease_tolerance_m3: 0.0005    # tolerate tiny rounding wobble (mÂ³)

schema:
  # Login
  email: str
  password: password

  # Polling (adaptive)
  idle_poll_seconds: int(30,)
  probe_after_minutes: int(1,)
  probe_poll_seconds: int(30,)
  probe_max_minutes: int(1,)
  min_poll_seconds: int(10,)
  jitter_seconds: int(0,)

  # Stability
  keep_last_on_error: bool
  allow_decrease: bool
  decrease_tolerance_m3: float
