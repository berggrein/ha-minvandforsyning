name: "Minvandforsyning Companion"
slug: "minvandforsyning"
version: "0.3.0"
description: Henter vandforbrug fra minvandforsyning.dk og eksponerer det til Home Assistant
arch:
  - amd64
  - aarch64
startup: application
boot: auto
ingress: false

ports:
  8080/tcp: 8080

options:
  email: ""
  password: ""
  port: 8080

  idle_poll_seconds: 1800
  probe_after_minutes: 45
  probe_poll_seconds: 120
  probe_max_minutes: 20
  jitter_seconds: 15

  keep_last_on_error: true
  allow_decrease: false
  decrease_tolerance_m3: 0.0005

schema:
  email:
    name: Login email
    description: >
      Email til en eksisterende bruger på minvandforsyning.dk.
      Add-on er kun testet med én bruger med præcis én tilknyttet måler.
    required: true

  password:
    name: Login adgangskode
    description: Adgangskode til minvandforsyning.dk
    type: password
    required: true

  port:
    name: Port
    description: TCP-port som add-on'en lytter på. Default 8080 anbefales.
    type: port
    required: true

  idle_poll_seconds:
    name: Normal opdateringsinterval (sekunder)
    description: >
      Hvor ofte der polles, når der ikke forventes ny data.
    type: int

  probe_after_minutes:
    name: Skift til hyppigere polling efter (minutter)
    description: >
      Tid efter sidste nye aflæsning før der tjekkes oftere.
    type: int

  probe_poll_seconds:
    name: Hyppigt opdateringsinterval (sekunder)
    description: >
      Hvor ofte der polles, når der forventes ny data.
    type: int

  probe_max_minutes:
    name: Maksimal periode for hyppig polling (minutter)
    description: >
      Hvor længe hyppig polling må køre før normal interval genoptages.
    type: int

  jitter_seconds:
    name: Tilfældig forsinkelse (sekunder)
    description: >
      Tilføjer variation for at undgå faste polling-mønstre.
    type: int

  keep_last_on_error:
    name: Behold seneste værdi ved fejl
    description: >
      Returnér seneste kendte målerstand selv hvis scraping fejler midlertidigt.
    type: bool

  allow_decrease:
    name: Tillad faldende total (ikke anbefalet)
    description: >
      Slå kun til hvis dit forsyningsselskab kan korrigere måleren.
    type: bool

  decrease_tolerance_m3:
    name: Tolerance for fald (m3)
    description: >
      Lille tolerance for afrundingsfejl hvis faldende total er tilladt.
    type: float
